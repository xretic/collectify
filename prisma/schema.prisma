// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
}

model User {
    id       Int     @id
    githubId String? @unique
    googleId String? @unique

    email        String  @unique
    passwordHash String?

    avatarUrl String @default("")
    bannerUrl String @default("")

    username String
    fullName String

    description String       @default("")
    collections Collection[]
    favorites   Collection[] @relation("FavoriteCollections")

    followers     Follow[] @relation("Followers")
    subscriptions Follow[] @relation("Subscriptions")

    notifications Notification[] @relation("ReceivedNotifications")

    sessions     Session[]
    Notification Notification[]
}

enum NotificationType {
    FOLLOW
    LIKE
    COMMENT
    FAVORITE
}

model Notification {
    id Int @id @default(autoincrement())

    type NotificationType

    recipientUserId Int
    recipientUser   User @relation("ReceivedNotifications", fields: [recipientUserId], references: [id], onDelete: Cascade)

    senderUserId Int?
    senderUser   User? @relation(fields: [senderUserId], references: [id], onDelete: Cascade)

    collectionId Int?
    collection   Collection? @relation(fields: [collectionId], references: [id])

    isRead    Boolean  @default(false)
    createdAt DateTime @default(now())
}

model Follow {
    followerId  Int
    followingId Int

    follower  User @relation("Subscriptions", fields: [followerId], references: [id], onDelete: Cascade)
    following User @relation("Followers", fields: [followingId], references: [id], onDelete: Cascade)

    @@id([followerId, followingId])
}

model Session {
    id        String   @id
    userId    Int
    expiresAt DateTime
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
}

model Collection {
    id Int @id @unique

    name            String
    description     String @default("")
    bannerUrl       String
    category        String
    likes           Like[]
    addedToFavorite User[] @relation("FavoriteCollections")
    items           Item[]

    User   User? @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId Int?

    createdAt    DateTime       @default(now())
    Notification Notification[]
}

model Like {
    id           Int        @id @default(autoincrement())
    userId       Int
    collectionId Int
    Collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
}

model Item {
    id Int @id @unique

    title       String
    description String
    tags        String[]

    Collection   Collection? @relation(fields: [collectionId], references: [id], onDelete: Cascade)
    collectionId Int?
}
